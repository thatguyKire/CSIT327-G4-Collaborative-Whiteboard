{% extends "core/base.html" %}
{% load static %}
{% block title %}Student Whiteboard - COLLABoard{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'session/css/whiteboard.css' %}">
<link rel="stylesheet" href="{% static 'session/css/upload.css' %}">
<link rel="stylesheet" href="{% static 'session/css/whiteboard_announcements.css' %}">

<h2 class="session-title">{{ session_title }}</h2>

<div class="whiteboard-container">
  <div id="drawToolbar" class="toolbar" role="toolbar">
    <button id="penBtn" class="btn btn-secondary active">Pen</button>
    <button id="eraserBtn" class="btn btn-secondary">Eraser</button>
    <label>Color: <input type="color" id="colorPicker" value="#000000"></label>
    <label>Size: <input type="range" id="sizePicker" min="1" max="20" value="3"></label>
    <div class="upload-section">
      <label for="fileInput" class="btn btn-secondary">üìÅ Upload</label>
      <input type="file" id="fileInput" accept="image/*,.pdf,.docx,.pptx" hidden>
      <div id="uploadStatus" class="upload-status"></div>
    </div>
    <div class="uploaded-files-container">
      <ul id="uploadedFiles" class="uploaded-files"></ul>
    </div>
  </div>

  <div id="viewOnlyBanner" class="readonly-toolbar">
    üëÄ View-only mode ‚Äî waiting for teacher permission
  </div>

  <canvas id="whiteboardCanvas"
          style="width:100%; height:600px; background:#fff; display:block;"
          width="1200" height="600"></canvas>

  <!-- STUDENT: announcements panel -->
  <aside class="announcement-box" id="studentAnnouncementBox"
         data-list-url="{% url 'notifications:session_student_announcements_json' session.id %}"
         aria-label="Session announcements">
    <h3>üì¢ Announcements</h3>
    <div class="sent-list" id="studentAnnouncementsList">
      <!-- JS will populate -->
    </div>
  </aside>
</div>

{{ can_draw|json_script:"can_draw_data" }}
<script>
  window.CAN_DRAW = JSON.parse(document.getElementById("can_draw_data").textContent);
  window.CURRENT_SESSION_ID = "{{ session.id }}";
  window.CURRENT_USER_ID = "{{ request.user.id }}";
  window.SUPABASE_URL = "{{ SUPABASE_URL }}";
  window.SUPABASE_ANON_KEY = "{{ SUPABASE_ANON_KEY }}";
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.6/dist/umd/supabase.js"></script>
<script src="{% static 'session/js/whiteboard.js' %}"></script>
<script src="{% static 'session/js/student_announcements.js' %}" defer></script>
<script src="{% static 'session/js/upload.js' %}" defer></script>
{% endblock %}
