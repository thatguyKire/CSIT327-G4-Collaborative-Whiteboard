{% load static %}

<!-- ğŸ’¬ Floating Chat Bubble (like Messenger) -->
<div id="chatBubble" class="chat-bubble" draggable="false" role="button" aria-haspopup="dialog" aria-controls="chatWindow" aria-label="Open chat" tabindex="0">
  <img src="{% static 'core/icons/collaboard-logo.png' %}" alt="Chat" class="bubble-icon">
  <span class="chat-badge" id="unreadBadge" role="status" aria-live="polite">0</span>
</div>

<!-- ğŸ’¬ Chat Window -->
<div id="chatWindow" class="chat-window hidden" role="dialog" aria-modal="false" aria-labelledby="chatWindowTitle">
  <div class="chat-window-header">
    <div class="chat-header-left">
      <img src="{% static 'core/icons/collaboard-logo.png' %}" alt="COLLABoard" class="header-logo">
      <span class="chat-title" id="chatWindowTitle">Chat</span>
    </div>
    <div class="chat-header-right">
      <span id="chatStatus" class="chat-status" aria-label="Connection status" title="Connection status">â—</span>
      <button id="minimizeBtn" class="header-btn" title="Minimize" type="button" aria-label="Minimize chat">âˆ’</button>
      <button id="closeBtn" class="header-btn" title="Close" type="button" aria-label="Close chat">Ã—</button>
    </div>
  </div>

  <div id="chatMessages" class="chat-messages" role="log" aria-live="polite" aria-relevant="additions text" aria-atomic="false">
    <div class="chat-empty">No messages yet. Start the conversation!</div>
  </div>

  <!-- POPUP WHEN DISABLED -->
  <div id="chatDisabledPopup"
       class="chat-disabled-popup hidden"
       role="alertdialog"
       aria-modal="false"
       aria-labelledby="chatDisabledTitle"
       aria-describedby="chatDisabledDesc"
       tabindex="-1">
    <h4 id="chatDisabledTitle">Chat Disabled</h4>
    <p id="chatDisabledDesc" class="chat-disabled-text">The teacher has disabled chat for now.</p>
    <button id="chatDisabledCloseBtn" type="button" class="chat-disabled-close" aria-label="Close notice">OK</button>
  </div>

  <div id="chatDisabledNotice" class="hidden" aria-hidden="true"></div> <!-- legacy hook -->

  <div class="chat-input-container">
    <input type="text" id="chatInput" placeholder="Type a message..." autocomplete="off" maxlength="500" aria-label="Type a message">
    <button id="chatSendBtn" class="chat-send" type="button" aria-label="Send message">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
        <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
</div>

<link rel="stylesheet" href="{% static 'chat/css/chat.css' %}">
<script src="{% static 'chat/js/chat.js' %}" defer></script>
